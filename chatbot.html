<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Keyboard Input for chat-bubble</title>

    <!-- for mobile screens -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- stylesheets are conveniently separated into components -->
    <link rel="stylesheet" media="all" href="./node_modules/chat-bubble/component/styles/setup.css">
    <link rel="stylesheet" media="all" href="./node_modules/chat-bubble/component/styles/says.css">
    <link rel="stylesheet" media="all" href="./node_modules/chat-bubble/component/styles/reply.css">
    <link rel="stylesheet" media="all" href="./node_modules/chat-bubble/component/styles/typing.css">
    <link rel="stylesheet" media="all" href="./node_modules/chat-bubble/component/styles/input.css">
</head>

<body style="-webkit-app-region: drag;">
    <div class="chatbot" >
        <div style="position: inherit;" id="chattt"></div>
    </div>

    <!-- import the JavaScript file -->
    <script src="./node_modules/chat-bubble/component/Bubbles.js"></script>
    <script>
        var chatWindow = new Bubbles(document.getElementById("chattt"), "chatWindow", {
            inputCallbackFn: function (o) {
                var miss = function () {
                    chatWindow.talk(
                        {
                            "i-dont-get-it": {
                                says: [
                                    "Sorry, I don't get it üòï. Pls repeat? Or you can just click below üëá"
                                ],
                                reply: o.convo[o.standingAnswer].reply
                            }
                        },
                        "i-dont-get-it"
                    )
                }

                var match = function (key) {
                    setTimeout(function () {
                        chatWindow.talk(convo, key) // restart current convo from point found in the answer
                    }, 600)
                }

                var strip = function (text) {
                    return text.toLowerCase().replace(/[\s.,\/#!$%\^&\*;:{}=\-_'"`~()]/g, "")
                }

                var found = false
                o.convo[o.standingAnswer].reply.forEach(function (e, i) {
                    strip(e.question).includes(strip(o.input)) && o.input.length > 0
                        ? (found = e.answer)
                        : found ? null : (found = false)
                })
                found ? match(found) : miss()
            }
        }) 
        var convo = {
            ice: {
                says: ["Hi", "Would you like banana or ice cream?"],
                reply: [
                    {
                        question: "Banana",
                        answer: "banana"
                    },
                    {
                        question: "Ice Cream",
                        answer: "ice-cream"
                    }
                ]
            },
            banana: {
                says: ["üçå"],
                reply: [
                    {
                        question: "Start Over",
                        answer: "ice"
                    }
                ]
            },
            "ice-cream": {
                says: ["üç¶"],
                reply: [
                    {
                        question: "Start Over",
                        answer: "ice"
                    }
                ]
            }
        }

        // pass JSON to your function and you're done!
        chatWindow.talk(convo)
    </script>
</body>